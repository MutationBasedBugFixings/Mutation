diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-b/.defects4j.config	2025-11-12 13:06:15.633282132 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-f/.defects4j.config	2025-11-12 13:06:19.322281868 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Closure
-vid=164b
+vid=164f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-b/src/com/google/javascript/rhino/jstype/ArrowType.java /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-f/src/com/google/javascript/rhino/jstype/ArrowType.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-b/src/com/google/javascript/rhino/jstype/ArrowType.java	2025-11-12 13:06:15.634282132 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-164-f/src/com/google/javascript/rhino/jstype/ArrowType.java	2025-11-12 13:06:19.469281858 +0800
@@ -125,13 +125,25 @@
 
       boolean thisIsVarArgs = thisParam.isVarArgs();
       boolean thatIsVarArgs = thatParam.isVarArgs();
+      boolean thisIsOptional = thisIsVarArgs || thisParam.isOptionalArg();
+      boolean thatIsOptional = thatIsVarArgs || thatParam.isOptionalArg();
 
       // "that" can't be a supertype, because it's missing a required argument.
+      if (!thisIsOptional && thatIsOptional) {
         // NOTE(nicksantos): In our type system, we use {function(...?)} and
         // {function(...NoType)} to to indicate that arity should not be
         // checked. Strictly speaking, this is not a correct formulation,
         // because now a sub-function can required arguments that are var_args
         // in the super-function. So we special-case this.
+        boolean isTopFunction =
+            thatIsVarArgs &&
+            (thatParamType == null ||
+             thatParamType.isUnknownType() ||
+             thatParamType.isNoType());
+        if (!isTopFunction) {
+          return false;
+        }
+      }
 
       // don't advance if we have variable arguments
       if (!thisIsVarArgs) {
@@ -149,6 +161,11 @@
     }
 
     // "that" can't be a supertype, because it's missing a required arguement.
+    if (thisParam != null
+        && !thisParam.isOptionalArg() && !thisParam.isVarArgs()
+        && thatParam == null) {
+      return false;
+    }
 
     return true;
   }
