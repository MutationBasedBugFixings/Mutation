diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/.defects4j.config	2025-11-12 13:06:39.612280418 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/.defects4j.config	2025-11-12 13:06:43.306280154 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Closure
-vid=167b
+vid=167f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java	2025-11-12 13:06:39.613280418 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/src/com/google/javascript/jscomp/type/SemanticReverseAbstractInterpreter.java	2025-11-12 13:06:43.455280143 +0800
@@ -298,8 +298,8 @@
     if (merged != null) {
       return maybeRestrictTwoNames(
           blindScope,
-          left, leftIsRefineable, merged.typeA,
-          right, rightIsRefineable, merged.typeB);
+          left, leftType, leftIsRefineable ? merged.typeA : null,
+          right, rightType, rightIsRefineable ? merged.typeB : null);
     }
     return blindScope;
   }
@@ -345,8 +345,8 @@
       // creating new scope
       return maybeRestrictTwoNames(
           blindScope,
-          left, leftIsRefineable, restrictedLeftType,
-          right, rightIsRefineable, restrictedRightType);
+          left, leftType, leftIsRefineable ? restrictedLeftType : null,
+          right, rightType, rightIsRefineable ? restrictedRightType : null);
     }
     return blindScope;
   }
@@ -391,7 +391,7 @@
    */
   private FlowScope maybeRestrictName(
       FlowScope blindScope, Node node, JSType originalType, JSType restrictedType) {
-    if (restrictedType != null && !restrictedType.equals(originalType)) {
+    if (restrictedType != null && restrictedType != originalType) {
       FlowScope informed = blindScope.createChildFlowScope();
       declareNameInScope(informed, node, restrictedType);
       return informed;
@@ -404,12 +404,12 @@
    */
   private FlowScope maybeRestrictTwoNames(
       FlowScope blindScope,
-      Node left, boolean leftIsRefineable, JSType restrictedLeftType,
-      Node right, boolean rightIsRefineable, JSType restrictedRightType) {
+      Node left, JSType originalLeftType, JSType restrictedLeftType,
+      Node right, JSType originalRightType, JSType restrictedRightType) {
     boolean shouldRefineLeft =
-        leftIsRefineable && restrictedLeftType != null;
+        restrictedLeftType != null && restrictedLeftType != originalLeftType;
     boolean shouldRefineRight =
-        rightIsRefineable && restrictedRightType != null;
+        restrictedRightType != null && restrictedRightType != originalRightType;
     if (shouldRefineLeft || shouldRefineRight) {
       FlowScope informed = blindScope.createChildFlowScope();
       if (shouldRefineLeft) {
@@ -427,11 +427,9 @@
       boolean outcome) {
     JSType type = getTypeIfRefinable(name, blindScope);
     if (type != null) {
-      JSType restrictedType =
-          type.getRestrictedTypeGivenToBooleanOutcome(outcome);
-      FlowScope informed = blindScope.createChildFlowScope();
-      declareNameInScope(informed, name, restrictedType);
-      return informed;
+      return maybeRestrictName(
+          blindScope, name, type,
+          type.getRestrictedTypeGivenToBooleanOutcome(outcome));
     }
     return blindScope;
   }
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/src/com/google/javascript/rhino/jstype/JSType.java /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/src/com/google/javascript/rhino/jstype/JSType.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-b/src/com/google/javascript/rhino/jstype/JSType.java	2025-11-12 13:06:39.614280418 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff/Closure-167-f/src/com/google/javascript/rhino/jstype/JSType.java	2025-11-12 13:06:43.455280143 +0800
@@ -880,6 +880,9 @@
    * method of types to get the restricted type.
    */
   public JSType getRestrictedTypeGivenToBooleanOutcome(boolean outcome) {
+    if (outcome && this == getNativeType(JSTypeNative.UNKNOWN_TYPE)) {
+      return getNativeType(JSTypeNative.CHECKED_UNKNOWN_TYPE);
+    }
 
     BooleanLiteralSet literals = getPossibleToBooleanOutcomes();
     if (literals.contains(outcome)) {
