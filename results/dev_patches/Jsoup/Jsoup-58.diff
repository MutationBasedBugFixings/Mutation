diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/.defects4j.config	2025-11-06 20:10:52.838060974 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/.defects4j.config	2025-11-06 20:10:55.455125869 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Jsoup
-vid=58b
+vid=58f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/Jsoup.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/Jsoup.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/Jsoup.java	2025-11-06 20:10:52.840061023 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/Jsoup.java	2025-11-06 20:10:55.505127105 +0800
@@ -247,7 +247,7 @@
      @see #clean(String, org.jsoup.safety.Whitelist) 
      */
     public static boolean isValid(String bodyHtml, Whitelist whitelist) {
-        return new Cleaner(whitelist).isValid(parseBodyFragment(bodyHtml, ""));
+        return new Cleaner(whitelist).isValidBodyHtml(bodyHtml);
     }
     
 }
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/parser/Parser.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/parser/Parser.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/parser/Parser.java	2025-11-06 20:10:52.840061023 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/parser/Parser.java	2025-11-06 20:10:55.505127105 +0800
@@ -126,6 +126,10 @@
      *
      * @return list of nodes parsed from the input HTML. Note that the context element, if supplied, is not modified.
      */
+    public static List<Node> parseFragment(String fragmentHtml, Element context, String baseUri, ParseErrorList errorList) {
+        HtmlTreeBuilder treeBuilder = new HtmlTreeBuilder();
+        return treeBuilder.parseFragment(fragmentHtml, context, baseUri, errorList, treeBuilder.defaultSettings());
+    }
 
     /**
      * Parse a fragment of XML into a list of nodes.
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/safety/Cleaner.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/safety/Cleaner.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-b/src/main/java/org/jsoup/safety/Cleaner.java	2025-11-06 20:10:52.841061048 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-58-f/src/main/java/org/jsoup/safety/Cleaner.java	2025-11-06 20:10:55.505127105 +0800
@@ -14,6 +14,7 @@
 import org.jsoup.select.NodeTraversor;
 import org.jsoup.select.NodeVisitor;
 
+import java.util.List;
 
 
 /**
@@ -75,9 +76,19 @@
 
         Document clean = Document.createShell(dirtyDocument.baseUri());
         int numDiscarded = copySafeNodes(dirtyDocument.body(), clean.body());
-        return numDiscarded == 0;
+        return numDiscarded == 0
+            && dirtyDocument.head().childNodes().size() == 0; // because we only look at the body, but we start from a shell, make sure there's nothing in the head
     }
 
+    public boolean isValidBodyHtml(String bodyHtml) {
+        Document clean = Document.createShell("");
+        Document dirty = Document.createShell("");
+        ParseErrorList errorList = ParseErrorList.tracking(1);
+        List<Node> nodes = Parser.parseFragment(bodyHtml, dirty.body(), "", errorList);
+        dirty.body().insertChildren(0, nodes);
+        int numDiscarded = copySafeNodes(dirty.body(), clean.body());
+        return numDiscarded == 0 && errorList.size() == 0;
+    }
 
     /**
      Iterates the input and copies trusted nodes (tags, attributes, text) into the destination.
