diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-b/.defects4j.config	2025-11-06 20:09:04.883018365 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-f/.defects4j.config	2025-11-06 20:09:06.432067436 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Jsoup
-vid=36b
+vid=36f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-b/src/main/java/org/jsoup/helper/DataUtil.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-f/src/main/java/org/jsoup/helper/DataUtil.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-b/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:09:04.884018397 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-36-f/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:09:06.474068765 +0800
@@ -7,6 +7,7 @@
 import java.io.*;
 import java.nio.ByteBuffer;
 import java.nio.charset.Charset;
+import java.nio.charset.IllegalCharsetNameException;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 import java.util.Locale;
@@ -16,7 +17,7 @@
  *
  */
 public class DataUtil {
-    private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*\"?([^\\s;\"]*)");
+    private static final Pattern charsetPattern = Pattern.compile("(?i)\\bcharset=\\s*(?:\"|')?([^\\s,;\"']*)");
     static final String defaultCharset = "UTF-8"; // used if not found in header or meta charset
     private static final int bufferSize = 0x20000; // ~130K.
 
@@ -84,11 +85,21 @@
                 String foundCharset;
                 if (meta.hasAttr("http-equiv")) {
                     foundCharset = getCharsetFromContentType(meta.attr("content"));
+                    if (foundCharset == null && meta.hasAttr("charset")) {
+                        try {
+                            if (Charset.isSupported(meta.attr("charset"))) {
+                                foundCharset = meta.attr("charset");
+                            }
+                        } catch (IllegalCharsetNameException e) {
+                            foundCharset = null;
+                        }
+                    }
                 } else {
                     foundCharset = meta.attr("charset");
                 }
 
                 if (foundCharset != null && foundCharset.length() != 0 && !foundCharset.equals(defaultCharset)) { // need to re-decode
+                    foundCharset = foundCharset.trim().replaceAll("[\"']", "");
                     charsetName = foundCharset;
                     byteData.rewind();
                     docData = Charset.forName(foundCharset).decode(byteData).toString();
@@ -158,10 +169,16 @@
         Matcher m = charsetPattern.matcher(contentType);
         if (m.find()) {
             String charset = m.group(1).trim();
+            charset = charset.replace("charset=", "");
+            if (charset.isEmpty()) return null;
+            try {
                 if (Charset.isSupported(charset)) return charset;
                 charset = charset.toUpperCase(Locale.ENGLISH);
                 if (Charset.isSupported(charset)) return charset;
+            } catch (IllegalCharsetNameException e) {
                 // if our advanced charset matching fails.... we just take the default
+                return null;
+            }
         }
         return null;
     }
