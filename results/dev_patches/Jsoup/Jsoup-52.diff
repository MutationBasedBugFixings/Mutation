diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/.defects4j.config	2025-11-06 20:10:20.783233717 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/.defects4j.config	2025-11-06 20:10:23.383303092 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Jsoup
-vid=52b
+vid=52f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/helper/DataUtil.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/helper/DataUtil.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:10:20.784233743 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:10:23.436304502 +0800
@@ -109,13 +109,7 @@
                     foundCharset = getCharsetFromContentType(meta.attr("content"));
                 }
                 if (foundCharset == null && meta.hasAttr("charset")) {
-                    try {
-                        if (Charset.isSupported(meta.attr("charset"))) {
                     foundCharset = meta.attr("charset");
-                        }
-                    } catch (IllegalCharsetNameException e) {
-                        foundCharset = null;
-                    }
                 }
             }
             // look for <?xml encoding='ISO-8859-1'?>
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/nodes/XmlDeclaration.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/nodes/XmlDeclaration.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/nodes/XmlDeclaration.java	2025-11-06 20:10:20.784233743 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/nodes/XmlDeclaration.java	2025-11-06 20:10:23.437304529 +0800
@@ -43,29 +43,17 @@
      @return XML declaration
      */
     public String getWholeDeclaration() {
-        final String decl = this.name;
-        if(decl.equals("xml") && attributes.size() > 1 ) {
-            StringBuilder sb = new StringBuilder(decl);
-            final String version = attributes.get("version");
-            if( version != null ) {
-                sb.append(" version=\"").append(version).append("\"");
-            }
-            final String encoding = attributes.get("encoding");
-            if( encoding != null ) {
-                sb.append(" encoding=\"").append(encoding).append("\"");
-            }
-            return sb.toString();
-        }
-        else {
-            return this.name;
-        }
+        return attributes.html().trim(); // attr html starts with a " "
     }
 
 	void outerHtmlHead(Appendable accum, int depth, Document.OutputSettings out) throws IOException {
         accum
             .append("<")
             .append(isProcessingInstruction ? "!" : "?")
-                .append(getWholeDeclaration())
+            .append(name);
+        attributes.html(accum, out);
+        accum
+            .append(isProcessingInstruction ? "!" : "?")
             .append(">");
     }
 
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/parser/XmlTreeBuilder.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java	2025-11-06 20:10:20.785233770 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-52-f/src/main/java/org/jsoup/parser/XmlTreeBuilder.java	2025-11-06 20:10:23.437304529 +0800
@@ -1,5 +1,6 @@
 package org.jsoup.parser;
 
+import org.jsoup.Jsoup;
 import org.jsoup.helper.Validate;
 import org.jsoup.nodes.*;
 
@@ -73,8 +74,10 @@
             // so we do a bit of a hack and parse the data as an element to pull the attributes out
             String data = comment.getData();
             if (data.length() > 1 && (data.startsWith("!") || data.startsWith("?"))) {
-                String declaration = data.substring(1);
-                insert = new XmlDeclaration(declaration, comment.baseUri(), data.startsWith("!"));
+                Document doc = Jsoup.parse("<" + data.substring(1, data.length() -1) + ">", baseUri, Parser.xmlParser());
+                Element el = doc.child(0);
+                insert = new XmlDeclaration(el.tagName(), comment.baseUri(), data.startsWith("!"));
+                insert.attributes().addAll(el.attributes());
             }
         }
         insertNode(insert);
