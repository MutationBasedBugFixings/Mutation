diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-b/.defects4j.config /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-f/.defects4j.config
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-b/.defects4j.config	2025-11-06 20:10:10.101944375 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-f/.defects4j.config	2025-11-06 20:10:12.725016078 +0800
@@ -1,3 +1,3 @@
 #File automatically generated by Defects4J
 pid=Jsoup
-vid=50b
+vid=50f
diff -ruN --exclude .git --exclude .svn --exclude .hg --exclude .idea --exclude .settings --exclude .classpath --exclude .project --exclude target --exclude build --exclude out --exclude bin --exclude '*.class' --exclude '*.jar' --exclude '*.war' --exclude '*.ear' --exclude '*.zip' --exclude '*.tar' --exclude '*.gz' /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-b/src/main/java/org/jsoup/helper/DataUtil.java /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-f/src/main/java/org/jsoup/helper/DataUtil.java
--- /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-b/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:10:10.103944430 +0800
+++ /home1/furqan/my_mutation_experiments/d4j_work_diff_jsoup/Jsoup-50-f/src/main/java/org/jsoup/helper/DataUtil.java	2025-11-06 20:10:12.773017387 +0800
@@ -90,6 +90,20 @@
         Document doc = null;
 
         // look for BOM - overrides any other header or input
+        byteData.mark();
+        byte[] bom = new byte[4];
+        byteData.get(bom);
+        byteData.rewind();
+        if (bom[0] == 0x00 && bom[1] == 0x00 && bom[2] == (byte) 0xFE && bom[3] == (byte) 0xFF || // BE
+                bom[0] == (byte) 0xFF && bom[1] == (byte) 0xFE && bom[2] == 0x00 && bom[3] == 0x00) { // LE
+            charsetName = "UTF-32"; // and I hope it's on your system
+        } else if (bom[0] == (byte) 0xFE && bom[1] == (byte) 0xFF || // BE
+                bom[0] == (byte) 0xFF && bom[1] == (byte) 0xFE) {
+            charsetName = "UTF-16"; // in all Javas
+        } else if (bom[0] == (byte) 0xEF && bom[1] == (byte) 0xBB && bom[2] == (byte) 0xBF) {
+            charsetName = "UTF-8"; // in all Javas
+            byteData.position(3); // 16 and 32 decoders consume the BOM to determine be/le; utf-8 should be consumed
+        }
 
         if (charsetName == null) { // determine from meta. safe parse as UTF-8
             // look for <meta http-equiv="Content-Type" content="text/html;charset=gb2312"> or HTML5 <meta charset="gb2312">
@@ -123,13 +137,6 @@
             Validate.notEmpty(charsetName, "Must set charset arg to character set of file to parse. Set to null to attempt to detect from HTML");
             docData = Charset.forName(charsetName).decode(byteData).toString();
         }
-        if (docData.length() > 0 && docData.charAt(0) == UNICODE_BOM) {
-            byteData.rewind();
-            docData = Charset.forName(defaultCharset).decode(byteData).toString();
-            docData = docData.substring(1);
-            charsetName = defaultCharset;
-            doc = null;
-        }
         if (doc == null) {
             doc = parser.parseInput(docData, baseUri);
             doc.outputSettings().charset(charsetName);
